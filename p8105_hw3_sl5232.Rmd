---
title: "p8105_hw3_sl5232"
author: "Shangsi Lin"
date: "2022/10/12"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

Load Data from p8015 dataset.
```{r load_one}
data("instacart")

instacart = 
  instacart %>% 
  as_tibble(instacart)
```

This dataset contains `r nrow(instacart)` rows and `r ncol(instacart)` columns, with each row resprenting a single product from an instacart order. Variables include identifiers for user, order, and product; the order in which each product was added to the cart. There are several order-level variables, describing the day and time of the order, and number of days since prior order. Then there are several item-specific variables, describing the product name (e.g. Yogurt, Avocado), department (e.g. dairy and eggs, produce), and aisle (e.g. yogurt, fresh fruits), and whether the item has been ordered by this user in the past. In total, there are `r instacart %>% select(product_id) %>% distinct %>% count` products found in `r instacart %>% select(user_id, order_id) %>% distinct %>% count` orders from `r instacart %>% select(user_id) %>% distinct %>% count` distinct users.

```{r answer_aisle}
aisle_df = instacart %>%
  count(aisle, name = "n_orders") %>% 
  arrange(desc(n_orders))
```
There are `r nrow(distinct(instacart, aisle_id))` distinct aisles, and the top five aisles from which most items are ordered from arefresh vegetables, fresh fruits, packaged vegetables fruits, yogurt, and packaged cheese.

```{r plot_item}
aisle_df %>% 
  filter(n_orders > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n_orders)) %>% 
  ggplot(aes(x = aisle, y = n_orders)) + 
  geom_point() + 
  labs(title = "Number of items for each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

The above code chunk makes a plot that shows the number of items ordered in each aisle that has more than 10000 items ordered.Aisles are arranged in a low to high fashion according to the number of items ordered.

```{r popular_table}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(desc(n)) %>%
  knitr::kable()
```

The above code chunk shows the three most popular items and their ordered times in each of the aisles "baking ingredients", "dog food care", "packaged vegetables fruits".

```{r ordered_time}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>%
  spread(key = order_dow, value = mean_hour) %>%
  knitr::kable(digits = 2)
```

The above code chunk shows the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.

## Problem 2

First,load and clean the dataset

```{r load_two}
accel_df = read.csv("data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols = activity_1:activity_1440,
    names_to = "activity_number",
    values_to = "activity_counts"
  ) %>% 
  mutate(day_type = ifelse(day == ("Sunday") | day == ("Saturday"), "weekends", "weekdays")) %>% 
  select(week, day_id, day, day_type, everything()) 
```

```{r accel_table}
accel_df %>% 
  group_by(day_id, day, day_type) %>% 
  summarize(daily_counts = sum(activity_counts)) %>% 
  knitr::kable()
```